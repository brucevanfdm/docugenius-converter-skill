# 支持的文档格式

## 支持的文件类型

此独立版本支持以下文档格式：

### Microsoft Word (.docx)
- **支持内容**：文字、标题（Heading 1-6）、列表、表格、文本格式（粗体、斜体）
- **提取质量**：优秀
- **图片提取**：❌ 暂不支持（当前版本）
- **新功能**：
  - ✅ 自动识别标题层级（Heading 1-6 → # 到 ######）
  - ✅ 保留文本格式（**粗体**、*斜体*、***粗斜体***）
  - ✅ 支持无序列表和有序列表
  - ✅ 兼容中文标题样式（"标题 1"、"标题 2"等）
- **注意事项**：
  - 不支持旧版 .doc 格式（需先转换为 .docx）
  - 复杂的格式会简化为 Markdown 基础格式
  - 表格会转换为 Markdown 表格格式
  - 表格单元格中的管道符（|）会自动转义

### Microsoft Excel (.xlsx)
- **支持内容**：表格数据、工作表
- **提取质量**：优秀
- **图片提取**：❌ 暂不支持（当前版本）
- **新功能**：
  - ✅ 智能处理空行和空单元格
  - ✅ 自动计算实际列数（忽略尾部空列）
  - ✅ 表格单元格内容规范化（转义特殊字符）
- **注意事项**：
  - 每个工作表会转换为独立的 Markdown 表格
  - 公式会显示为计算结果（data_only=True）
  - 不支持旧版 .xls 格式
  - 图表不会被提取
  - 合并单元格会被展开为独立单元格

### Microsoft PowerPoint (.pptx)
- **支持内容**：幻灯片文字
- **提取质量**：良好
- **图片提取**：❌ 暂不支持（当前版本）
- **注意事项**：
  - 每张幻灯片会转换为独立的章节（## Slide N）
  - 幻灯片之间使用 `---` 分隔
  - 动画和过渡效果不会保留
  - 不支持旧版 .ppt 格式
  - 只提取文本内容

### PDF (.pdf)
- **支持内容**：文字、表格
- **提取质量**：取决于 PDF 类型
- **图片提取**：❌ 暂不支持（当前版本）
- **新功能**：
  - ✅ 自动检测和提取表格（转换为 Markdown 表格）
  - ✅ 表格和文本分离显示
  - ✅ 表格单元格内容规范化
  - ✅ 多页PDF自动添加页码标题（## Page N）
- **注意事项**：
  - **文本型 PDF**：提取质量优秀
  - **扫描型 PDF**：质量取决于扫描质量和 OCR
  - **加密 PDF**：不支持
  - 复杂布局可能影响提取顺序
  - 使用 pdfplumber 库，对中文支持良好
  - 表格提取依赖PDF的内部结构，复杂表格可能需要手动调整

## 不支持的格式

以下格式暂不支持，需要先转换为支持的格式：

- **旧版 Office 格式**：.doc, .xls, .ppt
- **其他文档格式**：.odt, .rtf, .pages, .numbers, .key
- **图片格式**：.jpg, .png（这些已经是图片，无需转换）
- **压缩文件**：.zip, .rar

## 文件大小限制

- **硬性限制**：100MB（超过此大小将拒绝转换）
- **推荐大小**：< 50MB（更大的文件转换时间较长）
- **超大文件**：可能需要较长转换时间和更多内存
- **安全保护**：自动检测文件大小，防止内存溢出

## 输出格式

转换后的输出：

### Markdown 文件
- **保存位置**：`Markdown/` 子目录（在原文件所在目录下）
- **文件名**：与原文件相同，扩展名为 `.md`
- **编码**：UTF-8

### 输出示例

```
原始文件目录/
├── report.docx              # 原始文件
├── data.xlsx                # 原始文件
└── Markdown/                # 输出目录
    ├── report.md            # 转换后的 Markdown
    └── data.md              # 转换后的 Markdown
```

## 转换质量说明

### 文本提取
- **Word/Excel/PowerPoint**：质量优秀，能准确提取文本和表格
- **文本型 PDF**：质量优秀
- **扫描型 PDF**：质量取决于扫描质量

### 格式保留
- **标题**：✅ 完整保留（自动识别 Heading 1-6，转换为 # 到 ######）
- **段落**：✅ 保留
- **表格**：✅ 转换为 Markdown 表格格式
- **列表**：✅ 保留（无序列表 `- 项目`，有序列表 `1. 项目`）
- **粗体/斜体**：✅ 保留（转换为 Markdown 格式 `**粗体**` 和 `*斜体*`）
- **颜色/字体**：❌ 不保留（Markdown 不支持）
- **图片**：❌ 暂不支持提取
- **超链接**：❌ 暂不支持提取

### 当前版本限制

此独立版本专注于文本和表格提取，以下功能暂不支持：

- ❌ 图片提取
- ❌ 图表提取
- ❌ 嵌入对象提取
- ❌ 超链接提取
- ❌ 文档分割（超大文档）
- ❌ 样式保留（颜色、字体等）

## 依赖库说明

此独立版本使用以下轻量级 Python 库：

- **python-docx** (约 2MB) - 处理 Word 文档
- **openpyxl** (约 3MB) - 处理 Excel 文件
- **python-pptx** (约 2MB) - 处理 PowerPoint 文件
- **pdfplumber** (约 5MB) - 处理 PDF 文件

总大小约 10-15MB（包括依赖），比 markitdown 等重量级库轻得多。

**按需加载**：只有在转换特定格式时才会检查和加载对应的库，提高效率。

## 安全性特性

- ✅ **文件大小限制**：100MB 硬性限制，防止内存溢出
- ✅ **详细错误分类**：区分权限错误、内存错误、文件未找到等
- ✅ **空数据处理**：安全处理空表格、空单元格等边界情况
- ✅ **特殊字符转义**：自动转义 Markdown 表格分隔符（|）
- ✅ **按需依赖检查**：只检查当前文件类型所需的库，避免无关依赖阻塞

## 最佳实践

1. **使用新版格式**：优先使用 .docx、.xlsx、.pptx（不是 .doc、.xls、.ppt）
2. **文件大小**：建议 < 50MB，更大的文件可能需要更长时间
3. **PDF 类型**：文本型 PDF 效果最好，扫描型 PDF 建议先进行 OCR 处理
4. **表格复杂度**：简单表格转换效果最好，复杂嵌套表格可能需要手动调整
5. **检查输出**：转换后建议检查输出质量，必要时手动调整
6. **文档样式**：使用标准的 Word 样式（Heading 1-6）以获得最佳转换效果
7. **列表格式**：使用 Word 的内置列表功能，而不是手动添加符号
